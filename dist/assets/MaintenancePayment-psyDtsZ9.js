import{aa as v,ab as L,ac as T,ad as W,r as p,j as t,B as q,e as E}from"./index-BNH9iTYT.js";import{u as A}from"./index.esm-DfrZcD0-.js";import{T as i}from"./TextField-Du4Jw93l.js";import{B}from"./Button-NFEb7akR.js";import{A as d}from"./Alert-DyuWCoDj.js";import"./List-BkBvgyHE.js";import"./ButtonBase-Djntgs0r.js";import"./useId-cXK4N2WA.js";import"./Select-z8M_qAC4.js";import"./Menu-DnseiFJ2.js";import"./isHostComponent-DVu5iVWx.js";import"./Modal-Dru-Vug-.js";import"./IconButton-Bk_7tTm-.js";const X=()=>{var g,x,P,b;const{data:a,isLoading:y}=v(),{register:o,handleSubmit:M,setValue:s,watch:j,formState:{errors:n}}=A(),[w,{isLoading:h,isSuccess:O,isError:S,error:m}]=L(),[I]=T(),[_]=W(),[f,u]=p.useState(null);j("paymentMethod"),p.useEffect(()=>{const e=document.createElement("script");e.src="https://checkout.razorpay.com/v1/checkout.js",e.async=!0,document.body.appendChild(e)},[]),p.useEffect(()=>{if(a!=null&&a.setting){const{amount:e,month:r,year:c}=a.setting;s("amount",e),s("month",r),s("year",c)}},[a,s]);const z=async e=>{try{if(e.paymentMethod==="online"){const r=await I({amount:e.amount,month:e.month,year:e.year}).unwrap(),c={key:"rzp_test_Q2R8yPk3O6GHhU",amount:r.amount,currency:r.currency,name:"Society Maintenance",description:`Maintenance for ${e.month} ${e.year}`,order_id:r.id,handler:async function(l){try{await _({...e,razorpay_order_id:l.razorpay_order_id,razorpay_signature:l.razorpay_signature,transactionId:l.razorpay_payment_id}).unwrap(),u("success")}catch(k){console.error("Verification failed",k),u("failure")}},theme:{color:"#1976d2"}};new window.Razorpay(c).open()}else await w(e).unwrap(),u("success")}catch(r){console.error("Payment failed:",r),u("failure")}};return t.jsxs(q,{component:"form",onSubmit:M(z),sx:{maxWidth:400,mx:"auto",mt:4,p:3,borderRadius:2,backgroundColor:"background.paper",boxShadow:1},children:[t.jsx(E,{variant:"h6",gutterBottom:!0,children:"Pay Maintenance"}),t.jsx(i,{label:"Amount (â‚¹)",fullWidth:!0,type:"number",...o("amount",{required:"Amount is required"}),error:!!n.amount,helperText:(g=n.amount)==null?void 0:g.message,margin:"normal",InputProps:{readOnly:!0},InputLabelProps:{shrink:!0}}),t.jsx(i,{label:"Month",fullWidth:!0,...o("month",{required:"Month is required"}),error:!!n.month,helperText:(x=n.month)==null?void 0:x.message,margin:"normal",InputProps:{readOnly:!0},InputLabelProps:{shrink:!0}}),t.jsx(i,{label:"Year",fullWidth:!0,...o("year",{required:"Year is required"}),error:!!n.year,helperText:(P=n.year)==null?void 0:P.message,margin:"normal",InputProps:{readOnly:!0},InputLabelProps:{shrink:!0}}),t.jsx(i,{label:"Payment Method",fullWidth:!0,value:"online",InputProps:{readOnly:!0},...o("paymentMethod"),margin:"normal"}),t.jsx(i,{label:"Transaction ID (if any)",fullWidth:!0,...o("transactionId"),margin:"normal"}),t.jsx(B,{type:"submit",variant:"contained",fullWidth:!0,color:"secondary",sx:{mt:2},disabled:h||y,children:h?"Processing...":y?"Loading Setting...":"Pay Now"}),f==="success"&&t.jsx(d,{severity:"success",sx:{mt:2},children:"Payment successful!"}),f==="failure"&&t.jsx(d,{severity:"error",sx:{mt:2},children:"Payment failed. Please try again."}),S&&t.jsx(d,{severity:"error",sx:{mt:2},children:((b=m==null?void 0:m.data)==null?void 0:b.message)||"Something went wrong"})]})};export{X as default};
