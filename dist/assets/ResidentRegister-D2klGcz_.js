import{au as E,av as F,aw as D,r as W,ax as B,c as C,ay as h,j as e,Z as r,f as m,P as z,az as M,B as _,e as H,W as d,aA as L}from"./index-TOg4iC9X.js";import{u as U}from"./index.esm-B-kGqaSt.js";import{D as G,a as I,b as O,c as Q}from"./DialogTitle-DHDfifRQ.js";import{T as Z,a as $,b as J,c as S,d as T,e as K}from"./TableRow-Csk7A2q-.js";import{T as V}from"./TablePagination-5p5xmu9T.js";import"./MenuItem-DFBgWJ5J.js";import"./listItemTextClasses-BwEbF0GS.js";import"./dividerClasses-9ENEhr9G.js";import"./Toolbar-DEMU4rmm.js";const A=[{id:"name",label:"Name",minWidth:170,align:"left"},{id:"email",label:"Email",minWidth:200,align:"left"},{id:"phone",label:"Phone",minWidth:100,align:"left"},{id:"address",label:"Address",minWidth:170,align:"left"},{id:"flatNumber",label:"Flat Number",minWidth:170,align:"left"},{id:"isActive",label:"isActive?",minWidth:170,align:"left"},{id:"Actions",label:"Actions",minWidth:170,align:"left"}],X=()=>{const{data:i,refetch:o}=E(),[t,{isSuccess:w}]=F(),[j,{isSuccess:v}]=D(),[R,c]=W.useState(!1),[a,n]=W.useState({name:"",email:"",phone:"",address:"",flatNumber:"",isActive:!0}),x=s=>{n(s),o(),c(!0)},[g,{isloading:y,isSuccess:p}]=B(),f=async s=>{if(window.confirm("Are you sure you want to delete this resident?"))try{await t(s).unwrap(),h.success("Resident deleted successfully"),o()}catch(l){h.error("Failed to delete resident"),console.error(l)}},[u,P]=C.useState(0),[b,N]=C.useState(10),k=(s,l)=>{P(l)},q=s=>{N(+s.target.value),P(0)};return W.useEffect(()=>{p&&(h.success("user block success"),o())},[p]),e.jsxs(e.Fragment,{children:[e.jsxs(G,{open:R,onClose:()=>c(!1),fullWidth:!0,maxWidth:"sm",children:[e.jsx(I,{children:"Edit Resident"}),e.jsxs(O,{dividers:!0,children:[e.jsx(r,{label:"Name",value:a.name,fullWidth:!0,margin:"dense",onChange:s=>n({...a,name:s.target.value})}),e.jsx(r,{label:"Email",value:a.email,fullWidth:!0,margin:"dense",onChange:s=>n({...a,email:s.target.value})}),e.jsx(r,{label:"Phone",value:a.phone,fullWidth:!0,margin:"dense",onChange:s=>n({...a,phone:s.target.value})}),e.jsx(r,{label:"Address",value:a.address,fullWidth:!0,margin:"dense",onChange:s=>n({...a,address:s.target.value})}),e.jsx(r,{label:"Flat Number",value:a.flatNumber,fullWidth:!0,margin:"dense",onChange:s=>n({...a,flatNumber:s.target.value})})]}),e.jsxs(Q,{children:[e.jsx(m,{onClick:()=>c(!1),color:"error",children:"Cancel"}),e.jsx(m,{onClick:async()=>{try{await j({rid:a._id,updateData:a}).unwrap(),o(),h.success("Resident updated successfully"),c(!1)}catch(s){h.error("Failed to update resident"),console.error(s)}},color:"primary",variant:"contained",children:"Save"})]})]}),e.jsxs(z,{sx:{width:"100%",overflow:"hidden"},children:[e.jsx(Z,{sx:{maxHeight:440},children:e.jsxs($,{stickyHeader:!0,"aria-label":"Resident table",children:[e.jsx(J,{children:e.jsx(S,{children:A.map(s=>e.jsx(T,{align:s.align,style:{minWidth:s.minWidth},children:s.label},s.id))})}),e.jsx(K,{children:i==null?void 0:i.residents.slice(u*b,u*b+b).map(s=>e.jsx(S,{hover:!0,role:"checkbox",tabIndex:-1,children:A.map(l=>e.jsx(T,{align:l.align||"left",children:l.id==="Actions"?e.jsxs("div",{style:{display:"flex",gap:"0.5rem"},children:[e.jsx(m,{variant:"contained",color:"success",size:"small",onClick:()=>x(s),children:"Edit"}),e.jsx(m,{variant:"outlined",color:"error",size:"small",onClick:()=>f(s._id),children:"Delete"}),s.isActive?e.jsx(m,{variant:"contained",color:"warning",size:"small",onClick:async()=>{await g({rid:s._id,isActive:!1}).unwrap(),o()},children:"Block"}):e.jsx(m,{variant:"contained",color:"success",size:"small",onClick:async()=>{await g({rid:s._id,isActive:!0}).unwrap(),o()},children:"Unblock"})]}):l.id==="isActive"?s.isActive?"true":"false":s[l.id]},l.id))},s._id||s.email))})]})}),e.jsx(V,{rowsPerPageOptions:[10,25,100],component:"div",count:(i==null?void 0:i.residents.length)||0,rowsPerPage:b,page:u,onPageChange:k,onRowsPerPageChange:q})]})]})},de=()=>{var c,a,n,x,g,y;const{register:i,handleSubmit:o,formState:{errors:t},reset:w}=U(),[j,{isLoading:v}]=M(),R=async p=>{var f;try{await j(p).unwrap(),h.success("Resident registered successfully!"),w()}catch(u){h.error(((f=u==null?void 0:u.data)==null?void 0:f.message)||"Registration failed. Try again.")}};return e.jsxs(e.Fragment,{children:[e.jsxs(_,{component:"form",onSubmit:o(R),sx:{width:"100%",px:4,py:4,boxSizing:"border-box"},children:[e.jsx(H,{variant:"h4",align:"left",gutterBottom:!0,fontWeight:600,children:"Resident Registration"}),e.jsxs(d,{container:!0,spacing:3,mt:4,children:[e.jsx(d,{item:!0,xs:12,md:4,children:e.jsx(r,{style:{fontSize:"16px"},label:"Name",variant:"standard",fullWidth:!0,...i("name",{required:"Name is required"}),error:!!t.name,helperText:(c=t.name)==null?void 0:c.message})}),e.jsx(d,{item:!0,xs:12,md:4,children:e.jsx(r,{label:"Email",variant:"standard",fullWidth:!0,...i("email",{required:"Email is required",pattern:{value:/^\S+@\S+$/i,message:"Invalid email format"}}),error:!!t.email,helperText:(a=t.email)==null?void 0:a.message})}),e.jsx(d,{item:!0,xs:12,md:4,children:e.jsx(r,{label:"Phone",variant:"standard",fullWidth:!0,...i("phone",{required:"Phone is required"}),error:!!t.phone,helperText:(n=t.phone)==null?void 0:n.message})})]}),e.jsxs(d,{container:!0,spacing:3,mt:4,children:[e.jsx(d,{item:!0,xs:12,md:4,children:e.jsx(r,{label:"Flat Number",variant:"standard",fullWidth:!0,...i("flatNumber",{required:"Flat Number is required"}),error:!!t.flatNumber,helperText:(x=t.flatNumber)==null?void 0:x.message})}),e.jsx(d,{item:!0,xs:12,md:4,children:e.jsx(r,{label:"Address",variant:"standard",fullWidth:!0,...i("address",{required:"Address is required"}),error:!!t.address,helperText:(g=t.address)==null?void 0:g.message})}),e.jsx(d,{item:!0,xs:12,md:4,children:e.jsx(r,{label:"Password",type:"password",variant:"standard",fullWidth:!0,...i("password",{required:"Password is required",minLength:{value:6,message:"Password must be at least 6 characters"}}),error:!!t.password,helperText:(y=t.password)==null?void 0:y.message})})]}),e.jsx(d,{item:!0,xs:12,children:e.jsx(m,{style:{marginTop:"20px"},type:"submit",variant:"contained",color:"secondary",disabled:v,sx:{mt:1},children:v?"Registering...":"Register Resident"})})]}),e.jsx(L,{position:"top-right",autoClose:3e3}),e.jsx(X,{})]})};export{de as default};
