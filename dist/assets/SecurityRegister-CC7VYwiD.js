import{aB as G,aC as Q,aD as Z,aE as K,r as j,j as e,Z as n,f as m,ay as h,P as F,aF as X,B,e as D,W as g}from"./index-TOg4iC9X.js";import{u as Y}from"./index.esm-B-kGqaSt.js";import{D as ee,a as te,b as ie,c as ae}from"./DialogTitle-DHDfifRQ.js";import{M as N}from"./MenuItem-DFBgWJ5J.js";import{T as re,a as se,b as ne,c as O,d as U,e as le}from"./TableRow-Csk7A2q-.js";import{T as oe}from"./TablePagination-5p5xmu9T.js";import"./listItemTextClasses-BwEbF0GS.js";import"./dividerClasses-9ENEhr9G.js";import"./Toolbar-DEMU4rmm.js";const M=[{id:"name",label:"Name",minWidth:170,align:"left"},{id:"email",label:"Email",minWidth:200,align:"left"},{id:"phone",label:"Phone",minWidth:130,align:"left"},{id:"assignedArea",label:"Assigned Area",minWidth:130,align:"left"},{id:"shift",label:"Shift",minWidth:130,align:"left"},{id:"isActive",label:"isActive?",minWidth:100,align:"left"},{id:"Actions",label:"Actions",minWidth:200,align:"left"}],ce=()=>{var T,E,w;const{data:i,refetch:o}=G(),[r,{isSuccess:y}]=Q(),[C,{isSuccess:f}]=Z(),[S,{isSuccess:P}]=K(),[p,v]=j.useState(0),[A,c]=j.useState(!1),[d,W]=j.useState(10),[a,l]=j.useState({_id:"",name:"",email:"",phone:"",assignedArea:"",shift:"",isActive:!0}),u=[{value:"morning",label:"Morning"},{value:"afternoon",label:"Afternoon"},{value:"night",label:"Night"}],b=t=>{l(t),o(),c(!0)},$=(t,s)=>{v(s)},I=t=>{W(+t.target.value),v(0)},L=async t=>{try{await r({sid:t._id,isActive:!t.isActive}).unwrap(),h.success(`Security ${t.isActive?"blocked":"unblocked"} successfully`),o()}catch(s){h.error("Failed to update security status"),console.error(s)}},J=async t=>{if(window.confirm("Are you sure you want to delete this security guard?"))try{await C(t).unwrap(),h.success("Security guard deleted successfully"),o()}catch(s){h.error("Failed to delete security guard"),console.error(s)}},_=()=>{var q;if(!((q=i==null?void 0:i.security)!=null&&q.length)){h.warn("No data to export");return}const t=[],s=["Name","Email","Phone","Assigned Area","Shift","Is Active"];t.push(s.join(",")),i.security.forEach(x=>{const V=[`"${x.name}"`,`"${x.email}"`,`"${x.phone}"`,`"${x.assignedArea}"`,`"${x.shift}"`,x.isActive?"true":"false"];t.push(V.join(","))});const z=t.join(`
`),H=new Blob([z],{type:"text/csv"}),R=URL.createObjectURL(H),k=document.createElement("a");k.href=R,k.download="security-guards.csv",k.click(),URL.revokeObjectURL(R)};return j.useEffect(()=>{(y||f)&&o()},[y,f]),e.jsxs(e.Fragment,{children:[e.jsxs(ee,{open:A,onClose:()=>c(!1),fullWidth:!0,maxWidth:"sm",children:[e.jsx(te,{children:"Edit Security"}),e.jsxs(ie,{dividers:!0,children:[e.jsx(n,{label:"Name",value:a.name,fullWidth:!0,margin:"dense",onChange:t=>l({...a,name:t.target.value})}),e.jsx(n,{label:"Email",value:a.email,fullWidth:!0,margin:"dense",onChange:t=>l({...a,email:t.target.value})}),e.jsx(n,{label:"Phone",value:a.phone,fullWidth:!0,margin:"dense",onChange:t=>l({...a,phone:t.target.value})}),e.jsx(n,{label:"Assigned Area",value:a.assignedArea,fullWidth:!0,margin:"dense",onChange:t=>l({...a,assignedArea:t.target.value})}),e.jsx(n,{select:!0,label:"Shift",value:a.shift,fullWidth:!0,margin:"dense",onChange:t=>l({...a,shift:t.target.value}),children:u.map(t=>e.jsx(N,{value:t.value,children:t.label},t.value))})]}),e.jsxs(ae,{children:[e.jsx(m,{onClick:()=>c(!1),color:"error",children:"Cancel"}),e.jsx(m,{onClick:async()=>{try{await S({sid:a._id,updateData:a}).unwrap(),o(),h.success("Security updated successfully"),c(!1)}catch(t){h.error("Failed to update security"),console.error(t)}},color:"primary",variant:"contained",children:"Save"})]})]}),e.jsx(m,{variant:"outlined",onClick:_,style:{marginBottom:"1rem"},children:"Export CSV"}),e.jsxs(F,{sx:{width:"100%",overflow:"hidden"},children:[e.jsx(re,{sx:{maxHeight:440},children:e.jsxs(se,{stickyHeader:!0,"aria-label":"Security Table",children:[e.jsx(ne,{children:e.jsx(O,{children:M.map(t=>e.jsx(U,{align:t.align,style:{minWidth:t.minWidth},children:t.label},t.id))})}),e.jsx(le,{children:(E=(T=i==null?void 0:i.security)==null?void 0:T.slice(p*d,p*d+d))==null?void 0:E.map(t=>e.jsx(O,{hover:!0,role:"checkbox",tabIndex:-1,children:M.map(s=>e.jsx(U,{align:s.align,children:s.id==="Actions"?e.jsxs("div",{style:{display:"flex",gap:"0.5rem"},children:[e.jsx(m,{variant:"contained",color:t.isActive?"warning":"success",size:"small",onClick:()=>L(t),children:t.isActive?"Block":"Unblock"}),e.jsx(m,{variant:"contained",color:"success",size:"small",onClick:()=>b(t),children:"Edit"}),e.jsx(m,{variant:"outlined",color:"error",size:"small",onClick:()=>J(t._id),children:"Delete"})]}):s.id==="isActive"?t.isActive?"true":"false":t[s.id]},s.id))},t._id))})]})}),e.jsx(oe,{rowsPerPageOptions:[10,25,100],component:"div",count:((w=i==null?void 0:i.security)==null?void 0:w.length)||0,rowsPerPage:d,page:p,onPageChange:$,onRowsPerPageChange:I})]})]})},be=()=>{var v,A,c,d,W,a,l;const{register:i,handleSubmit:o,formState:{errors:r},reset:y}=Y(),[C,{isLoading:f,error:S}]=X(),P=async u=>{try{const b=await C(u);console.log("Security registered successfully:",b),y()}catch(b){console.error("Error registering security:",b)}},p=[{value:"morning",label:"Morning"},{value:"afternoon",label:"Afternoon"},{value:"night",label:"Night"}];return e.jsxs(B,{sx:{maxWidth:"1000px",mx:"auto",mt:5,px:2},children:[e.jsxs(F,{elevation:4,sx:{p:4,borderRadius:3},children:[e.jsx(D,{variant:"h5",gutterBottom:!0,align:"center",children:"Security Registration Form"}),e.jsx(B,{component:"form",onSubmit:o(P),noValidate:!0,children:e.jsxs(g,{container:!0,spacing:3,children:[e.jsx(g,{item:!0,xs:12,md:6,children:e.jsx(n,{variant:"standard",label:"Name",fullWidth:!0,...i("name",{required:"Name is required"}),error:!!r.name,helperText:(v=r.name)==null?void 0:v.message})}),e.jsx(g,{item:!0,xs:12,md:6,children:e.jsx(n,{variant:"standard",label:"Email",fullWidth:!0,...i("email",{required:"Email is required",pattern:{value:/^\S+@\S+$/i,message:"Invalid email format"}}),error:!!r.email,helperText:(A=r.email)==null?void 0:A.message})}),e.jsx(g,{item:!0,xs:12,md:6,children:e.jsx(n,{variant:"standard",label:"Phone",fullWidth:!0,...i("phone",{required:"Phone is required",pattern:{value:/^[6-9]\d{9}$/,message:"Invalid phone number"}}),error:!!r.phone,helperText:(c=r.phone)==null?void 0:c.message})}),e.jsx(n,{variant:"standard",label:"Shift",select:!0,fullWidth:!0,...i("shift",{required:"Shift is required"}),error:!!r.shift,helperText:(d=r.shift)==null?void 0:d.message,children:p.map(u=>e.jsx(N,{value:u.value,children:u.label},u.value))}),e.jsx(g,{item:!0,xs:12,md:6,children:e.jsx(n,{variant:"standard",label:"Assigned Area",fullWidth:!0,...i("assignedArea",{required:"Assigned area is required"}),error:!!r.assignedArea,helperText:(W=r.assignedArea)==null?void 0:W.message})}),e.jsx(g,{item:!0,xs:12,md:6,children:e.jsx(n,{variant:"standard",label:"Date Of Joining",type:"date",fullWidth:!0,InputLabelProps:{shrink:!0},...i("dateOfJoining",{required:"Joining date is required"}),error:!!r.dateOfJoining,helperText:(a=r.dateOfJoining)==null?void 0:a.message})}),e.jsx(m,{type:"submit",variant:"contained",color:"primary",fullWidth:!0,size:"large",disabled:f,children:f?"Registering...":"Register Security"}),S&&e.jsx(g,{item:!0,xs:12,children:e.jsxs(D,{color:"error",align:"center",children:["Registration failed: ",((l=S.data)==null?void 0:l.message)||"Unknown error"]})})]})})]}),e.jsx(ce,{})]})};export{be as default};
